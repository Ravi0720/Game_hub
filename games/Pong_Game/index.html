<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong Game</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(to bottom, #1a1a1a, #000);
            color: white;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        #menu {
            text-align: center;
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        canvas {
            border: 3px solid #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            border-radius: 5px;
            background-color: #111;
        }

        button {
            font-size: 24px;
            padding: 15px 30px;
            background: linear-gradient(#00ff88, #00b760);
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.7);
        }

        h1 {
            font-size: 48px;
            text-shadow: 0 0 10px #00ff88;
        }

        #game-over {
            position: absolute;
            text-align: center;
            width: 100%;
            top: 50%;
            transform: translateY(-50%);
            display: none;
            animation: fadeIn 1s ease-in;
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>Pong Game</h1>
        <button id="singlePlayerBtn">Single Player</button>
        <button id="multiPlayerBtn">Multiplayer</button>
    </div>
    <canvas id="pong"></canvas>
    <div id="game-over">
        <h1 id="winner-text"></h1>
        <button id="restartBtn">Play Again</button>
    </div>

    <script>
        const canvas = document.getElementById('pong');
        const ctx = canvas.getContext('2d');
        let gameMode = ''; // 'single' or 'multi'

        // Game constants
        const PADDLE_WIDTH = 10;
        const PADDLE_HEIGHT = 100;
        const BALL_RADIUS = 10;
        const PADDLE_SPEED = 8;
        const BALL_SPEED = 7;
        const MAX_SCORE = 5;
        const AI_REACTION_TIME = 0.1; // Seconds for AI to react
        const AI_ACCURACY = 0.8; // 0 to 1, lower is more error

        // Game state
        const gameState = {
            leftScore: 0,
            rightScore: 0,
            isPaused: false,
            gameOver: false,
            lastScored: null
        };

        // Game objects
        const leftPaddle = {
            x: 20,
            y: canvas.height / 2 - PADDLE_HEIGHT / 2,
            width: PADDLE_WIDTH,
            height: PADDLE_HEIGHT,
            dy: 0,
            color: '#00ff88'
        };

        const rightPaddle = {
            x: canvas.width - PADDLE_WIDTH - 20,
            y: canvas.height / 2 - PADDLE_HEIGHT / 2,
            width: PADDLE_WIDTH,
            height: PADDLE_HEIGHT,
            dy: 0,
            color: '#00ff88'
        };

        const ball = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            dx: BALL_SPEED,
            dy: BALL_SPEED,
            radius: BALL_RADIUS,
            color: '#00ff88',
            trail: []
        };

        // Sound effects
        const sounds = {
            paddleHit: new Audio('https://cdn.pixabay.com/audio/2023/08/29/10-40-24-141_200x200.mp3'),
            score: new Audio('https://cdn.pixabay.com/audio/2023/09/01/14-42-21-391_200x200.mp3'),
            wallHit: new Audio('https://cdn.pixabay.com/audio/2023/09/01/14-41-49-468_200x200.mp3')
        };

        // Hide canvas initially
        canvas.style.display = 'none';

        // Draw functions
        function drawPaddle(paddle) {
            ctx.fillStyle = paddle.color;
            ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
        }

        function drawBall() {
            // Draw trail
            ball.trail.forEach((pos, index) => {
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, ball.radius * (1 - index / 5), 0, Math.PI * 2);
                ctx.fillStyle = `rgba(0, 255, 136, ${0.2 * (1 - index / 5)})`;
                ctx.fill();
                ctx.closePath();
            });

            // Draw ball
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fillStyle = ball.color;
            ctx.fill();
            ctx.closePath();

            // Update trail
            ball.trail.unshift({ x: ball.x, y: ball.y });
            if (ball.trail.length > 5) ball.trail.pop();
        }

        function drawScores() {
            ctx.font = '40px "Courier New"';
            ctx.fillStyle = '#00ff88';
            ctx.textAlign = 'center';
            ctx.fillText(gameState.leftScore, canvas.width / 4, 50);
            ctx.fillText(gameState.rightScore, 3 * canvas.width / 4, 50);

            if (gameState.lastScored === 'left') {
                ctx.fillStyle = 'rgba(0, 255, 136, 0.3)';
                ctx.fillRect(0, 0, canvas.width / 2, 50);
            } else if (gameState.lastScored === 'right') {
                ctx.fillStyle = 'rgba(0, 255, 136, 0.3)';
                ctx.fillRect(canvas.width / 2, 0, canvas.width / 2, 50);
            }
        }

        function drawNet() {
            ctx.setLineDash([10, 10]);
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (gameState.gameOver) {
                document.getElementById('game-over').style.display = 'block';
                document.getElementById('winner-text').textContent = 
                    `${gameState.leftScore >= MAX_SCORE ? 'Left' : 'Right'} Player Wins!`;
                return;
            }

            drawNet();
            drawPaddle(leftPaddle);
            drawPaddle(rightPaddle);
            drawBall();
            drawScores();
        }

        // Movement and collision
        function movePaddles() {
            leftPaddle.y = Math.max(0, Math.min(canvas.height - leftPaddle.height, leftPaddle.y + leftPaddle.dy));
            rightPaddle.y = Math.max(0, Math.min(canvas.height - rightPaddle.height, rightPaddle.y + rightPaddle.dy));

            // AI for single-player
            if (gameMode === 'single' && ball.dx > 0) {
                const targetY = ball.y - rightPaddle.height / 2 + (Math.random() - 0.5) * (1 - AI_ACCURACY) * 100;
                const deltaY = targetY - rightPaddle.y;
                rightPaddle.dy = deltaY * AI_REACTION_TIME;
            }
        }

        function moveBall() {
            if (gameState.isPaused || gameState.gameOver) return;

            ball.x += ball.dx;
            ball.y += ball.dy;

            if (ball.y - ball.radius < 0 || ball.y + ball.radius > canvas.height) {
                ball.dy = -ball.dy;
                sounds.wallHit.play();
            }

            if (
                (ball.x - ball.radius < leftPaddle.x + leftPaddle.width &&
                 ball.y > leftPaddle.y &&
                 ball.y < leftPaddle.y + leftPaddle.height) ||
                (ball.x + ball.radius > rightPaddle.x &&
                 ball.y > rightPaddle.y &&
                 ball.y < rightPaddle.y + rightPaddle.height)
            ) {
                const paddle = ball.x < canvas.width / 2 ? leftPaddle : rightPaddle;
                const hitPos = (ball.y - paddle.y) / paddle.height;
                ball.dy = 2 * BALL_SPEED * (hitPos - 0.5);
                ball.dx = -ball.dx * 1.05;
                sounds.paddleHit.play();
            }

            if (ball.x < 0) {
                gameState.rightScore++;
                gameState.lastScored = 'right';
                sounds.score.play();
                resetBall(-1);
            } else if (ball.x > canvas.width) {
                gameState.leftScore++;
                gameState.lastScored = 'left';
                sounds.score.play();
                resetBall(1);
            }

            if (gameState.leftScore >= MAX_SCORE || gameState.rightScore >= MAX_SCORE) {
                gameState.gameOver = true;
            }
        }

        function resetBall(direction) {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.dx = direction * BALL_SPEED;
            ball.dy = BALL_SPEED * (Math.random() * 2 - 1);
            ball.trail = [];
            gameState.isPaused = true;
            setTimeout(() => {
                gameState.isPaused = false;
                gameState.lastScored = null;
            }, 1000);
        }

        // Game loop
        function update() {
            if (!gameState.gameOver) {
                movePaddles();
                moveBall();
            }
            draw();
            requestAnimationFrame(update);
        }

        // Input handling
        const keys = {
            w: { down: false, action: () => leftPaddle.dy = -PADDLE_SPEED },
            s: { down: false, action: () => leftPaddle.dy = PADDLE_SPEED },
            ArrowUp: { down: false, action: () => rightPaddle.dy = -PADDLE_SPEED },
            ArrowDown: { down: false, action: () => rightPaddle.dy = PADDLE_SPEED },
            ' ': { down: false, action: () => {
                if (gameState.gameOver) {
                    restartGame();
                }
            }}
        };

        document.addEventListener('keydown', (e) => {
            if (keys[e.key]) {
                keys[e.key].down = true;
                keys[e.key].action();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (keys[e.key]) {
                keys[e.key].down = false;
                if (['w', 's'].includes(e.key)) leftPaddle.dy = 0;
                if (['ArrowUp', 'ArrowDown'].includes(e.key)) rightPaddle.dy = 0;
            }
        });

        // Button listeners
        document.getElementById('singlePlayerBtn').addEventListener('click', () => {
            gameMode = 'single';
            startGame();
        });

        document.getElementById('multiPlayerBtn').addEventListener('click', () => {
            gameMode = 'multi';
            startGame();
        });

        document.getElementById('restartBtn').addEventListener('click', () => {
            restartGame();
        });

        function startGame() {
            document.getElementById('menu').style.display = 'none';
            canvas.style.display = 'block';
            canvas.width = 800;
            canvas.height = 400;
            leftPaddle.x = 20;
            rightPaddle.x = canvas.width - PADDLE_WIDTH - 20;
            update();
        }

        function restartGame() {
            gameState.leftScore = 0;
            gameState.rightScore = 0;
            gameState.gameOver = false;
            gameState.lastScored = null;
            document.getElementById('game-over').style.display = 'none';
            resetBall(1);
        }
    </script>
</body>
</html>
